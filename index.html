<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¬ãƒãƒ£å ã„ è¶…æœ¬æ ¼ç‰ˆ - ã‚ªã‚«ãƒ«ãƒˆæƒ…å ±çµ±åˆã‚·ã‚¹ãƒ†ãƒ </title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&family=Zen+Maru+Gothic:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        :root { --primary:#8B4789; --secondary:#E6D5E8; --accent:#FFD700; --dark:#2C1B3D; --light:#FAF7FB; --text:#3D2645; }
        body { font-family:'Zen Maru Gothic',sans-serif; background:linear-gradient(135deg,#1e1140 0%,#3d2463 50%,#1e1140 100%); color:var(--text); min-height:100vh; position:relative; overflow-x:hidden; }
        body::before { content:''; position:fixed; top:0; left:0; right:0; bottom:0; background:radial-gradient(circle at 20% 30%,rgba(139,71,137,.1) 0%,transparent 50%),radial-gradient(circle at 80% 70%,rgba(255,215,0,.05) 0%,transparent 50%); pointer-events:none; z-index:0; }
        .stars { position:fixed; top:0; left:0; right:0; bottom:0; pointer-events:none; z-index:0; }
        .star { position:absolute; width:2px; height:2px; background:white; border-radius:50%; animation:twinkle 3s infinite; }
        @keyframes twinkle { 0%,100%{opacity:.3} 50%{opacity:1} }
        .container { max-width:900px; margin:0 auto; padding:40px 20px; position:relative; z-index:1; }
        header { text-align:center; margin-bottom:50px; animation:fadeInDown 1s ease-out; }
        h1 { font-family:'Noto Serif JP',serif; font-size:2.8rem; font-weight:700; background:linear-gradient(135deg,#FFD700,#FFA500,#FFD700); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:15px; letter-spacing:.05em; }
        .subtitle { font-size:1rem; color:var(--secondary); font-weight:300; letter-spacing:.1em; }
        .card { background:rgba(255,255,255,.95); border-radius:20px; padding:40px; box-shadow:0 20px 60px rgba(0,0,0,.3),0 0 0 1px rgba(255,215,0,.1); margin-bottom:30px; animation:fadeInUp 1s ease-out; backdrop-filter:blur(10px); }
        .form-group { margin-bottom:25px; }
        label { display:block; font-weight:700; margin-bottom:10px; color:var(--primary); font-size:1.1rem; font-family:'Noto Serif JP',serif; }
        input, select { width:100%; padding:15px; border:2px solid var(--secondary); border-radius:10px; font-size:1rem; font-family:'Zen Maru Gothic',sans-serif; transition:all .3s ease; background:white; }
        input:focus, select:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(139,71,137,.1); }
        .optional { font-size:.85rem; color:#999; font-weight:400; margin-left:5px; }
        button { width:100%; padding:20px; background:linear-gradient(135deg,var(--primary),#6B3567); color:white; border:none; border-radius:15px; font-size:1.3rem; font-weight:700; cursor:pointer; transition:all .3s ease; font-family:'Noto Serif JP',serif; letter-spacing:.05em; box-shadow:0 10px 30px rgba(139,71,137,.3); position:relative; overflow:hidden; }
        button::before { content:''; position:absolute; top:50%; left:50%; width:0; height:0; border-radius:50%; background:rgba(255,255,255,.2); transform:translate(-50%,-50%); transition:width .6s,height .6s; }
        button:hover::before { width:300px; height:300px; }
        button:hover { transform:translateY(-2px); box-shadow:0 15px 40px rgba(139,71,137,.4); }
        .result { display:none; animation:fadeInUp 1s ease-out; }
        .result.show { display:block; }
        .lucky-time { background:linear-gradient(135deg,#FFD700,#FFA500); padding:30px; border-radius:15px; margin-bottom:20px; color:white; text-align:center; box-shadow:0 10px 30px rgba(255,215,0,.3); }
        .lucky-time h2 { font-family:'Noto Serif JP',serif; font-size:1.8rem; margin-bottom:15px; font-weight:700; }
        .time-slot { background:rgba(255,255,255,.2); padding:20px; border-radius:10px; margin:15px 0; backdrop-filter:blur(10px); }
        .time-slot h3 { font-size:1.3rem; margin-bottom:10px; font-weight:700; }
        .time-slot p { font-size:1.5rem; font-weight:700; font-family:'Noto Serif JP',serif; }
        .divination-section { background:var(--light); padding:25px; border-radius:15px; margin-bottom:20px; border-left:5px solid var(--primary); }
        .divination-section h3 { font-family:'Noto Serif JP',serif; color:var(--primary); font-size:1.3rem; margin-bottom:15px; font-weight:700; }
        .divination-section p { line-height:1.8; color:var(--text); }
        .lucky-action { background:linear-gradient(135deg,var(--secondary),#D4BDD6); padding:25px; border-radius:15px; margin-top:20px; }
        .lucky-action h3 { font-family:'Noto Serif JP',serif; color:var(--primary); font-size:1.3rem; margin-bottom:15px; font-weight:700; }
        .lucky-action ul { list-style:none; padding-left:0; }
        .lucky-action li { padding:10px 0; padding-left:30px; position:relative; line-height:1.6; }
        .lucky-action li::before { content:'âœ¨'; position:absolute; left:0; top:10px; }
        .download-pdf-btn { width:100%; padding:18px; background:linear-gradient(135deg,#FFD700,#FFA500); color:white; border:none; border-radius:15px; font-size:1.2rem; font-weight:700; cursor:pointer; transition:all .3s ease; font-family:'Noto Serif JP',serif; letter-spacing:.05em; box-shadow:0 10px 30px rgba(255,215,0,.3); margin-top:20px; position:relative; overflow:hidden; }
        .download-pdf-btn:hover { transform:translateY(-2px); box-shadow:0 15px 40px rgba(255,215,0,.4); }
        .lucky-girl { text-align:center; margin:30px 0; animation:fadeInUp 1.5s ease-out; }
        .lucky-girl img { max-width:100%; border-radius:20px; box-shadow:0 20px 60px rgba(139,71,137,.3); border:5px solid var(--accent); }
        .lucky-girl h3 { font-family:'Noto Serif JP',serif; color:var(--primary); font-size:1.5rem; margin:20px 0 10px; font-weight:700; }
        .lucky-girl p { color:var(--text); font-size:1.1rem; line-height:1.8; }
        footer { text-align:center; padding:30px; color:var(--secondary); font-size:.9rem; }
        @keyframes fadeInDown { from{opacity:0;transform:translateY(-30px)} to{opacity:1;transform:translateY(0)} }
        @keyframes fadeInUp { from{opacity:0;transform:translateY(30px)} to{opacity:1;transform:translateY(0)} }
        .loading { display:none; text-align:center; padding:40px; }
        .loading.show { display:block; }
        .spinner { width:60px; height:60px; border:5px solid rgba(139,71,137,.2); border-top-color:var(--primary); border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 20px; }
        @keyframes spin { to{transform:rotate(360deg)} }
        @media(max-width:768px){ h1{font-size:2rem} .card{padding:25px} .lucky-time h2{font-size:1.5rem} }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    <div class="container">
        <header>
            <h1>ğŸ”® ã‚¬ãƒãƒ£å ã„ è¶…æœ¬æ ¼ç‰ˆ</h1>
            <p class="subtitle">å…¨å è¡“ Ã— ã‚ªã‚«ãƒ«ãƒˆæƒ…å ± çµ±åˆã‚·ã‚¹ãƒ†ãƒ  by ã‚¯ãƒˆã¡ã‚ƒã‚“</p>
            <p style="font-size:.9rem;color:var(--secondary);margin-top:10px;">ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆæ™‚åˆ» | 10é€£æ¨å¥¨å›æ•° | ã‚²ãƒ¼ãƒ åˆ¥ã‚¸ãƒ³ã‚¯ã‚¹å®Œå…¨å¯¾å¿œ</p>
        </header>

        <div class="card">
            <form id="fortuneForm">
                <div class="form-group">
                    <label for="gameTitle">ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«</label>
                    <select id="gameTitle" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ã‚¦ãƒå¨˜">ã‚¦ãƒå¨˜ ãƒ—ãƒªãƒ†ã‚£ãƒ¼ãƒ€ãƒ¼ãƒ“ãƒ¼</option>
                        <option value="ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–">ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</option>
                        <option value="åŸç¥">åŸç¥</option>
                        <option value="NIKKE">å‹åˆ©ã®å¥³ç¥ï¼šNIKKE</option>
                        <option value="å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«">å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«</option>
                        <option value="é³´æ½®">é³´æ½®</option>
                        <option value="Fate/GO">Fate/Grand Order</option>
                        <option value="ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­">ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­</option>
                        <option value="LINE MF">LINE ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒ•ã‚¡ãƒ¼ãƒ </option>
                        <option value="Echocalypse">Echocalypse</option>
                        <option value="Evertale">Evertale</option>
                        <option value="PokÃ©mon Trading Card Game Pocket">PokÃ©mon TCG Pocket</option>
                        <option value="ãƒ—ãƒªã‚³ãƒR">ãƒ—ãƒªãƒ³ã‚»ã‚¹ã‚³ãƒã‚¯ãƒˆï¼Re:Dive</option>
                        <option value="ã‚°ãƒ©ãƒ–ãƒ«">ã‚°ãƒ©ãƒ³ãƒ–ãƒ«ãƒ¼ãƒ•ã‚¡ãƒ³ã‚¿ã‚¸ãƒ¼</option>
                        <option value="ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³">ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³</option>
                        <option value="ãƒ˜ãƒ–ãƒãƒ³">ãƒ˜ãƒ–ãƒ³ãƒãƒ¼ãƒ³ã‚ºãƒ¬ãƒƒãƒ‰</option>
                        <option value="DQã‚¦ã‚©ãƒ¼ã‚¯">ãƒ‰ãƒ©ã‚´ãƒ³ã‚¯ã‚¨ã‚¹ãƒˆã‚¦ã‚©ãƒ¼ã‚¯</option>
                        <option value="ç™½çŒ«">ç™½çŒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>
                <div class="form-group" id="customGameGroup" style="display:none;">
                    <label for="customGame">ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›</label>
                    <input type="text" id="customGame" placeholder="ä¾‹: ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¹ãƒˆãƒ©ã‚¤ã‚¯">
                </div>
                <div class="form-group">
                    <label for="targetName">ç‹™ã£ã¦ã„ã‚‹ã‚­ãƒ£ãƒ©/æ­¦å™¨å <span class="optional">(ä»»æ„)</span></label>
                    <input type="text" id="targetName" placeholder="ä¾‹: é«˜å‚éº—å¥ˆã€è‰è–™ã®å‰£">
                </div>
                <div class="form-group">
                    <label for="gachaTitle">ã‚¬ãƒãƒ£ã‚¿ã‚¤ãƒˆãƒ« <span class="optional">(ä»»æ„)</span></label>
                    <input type="text" id="gachaTitle" placeholder="ä¾‹: éŸ¿ã‘!ãƒ¦ãƒ¼ãƒ•ã‚©ãƒ‹ã‚¢ãƒ ã‚³ãƒ©ãƒœã€æ­£æœˆã‚¬ãƒãƒ£">
                </div>
                <div class="form-group">
                    <label for="gachaDeadline">ã‚¬ãƒãƒ£æœŸé™ï¼ˆæ—¥ä»˜ï¼‰ <span class="optional">(ä»»æ„)</span></label>
                    <input type="date" id="gachaDeadline" min="">
                </div>
                <div class="form-group">
                    <label for="gachaDeadlineTime">ã‚¬ãƒãƒ£æœŸé™ï¼ˆæ™‚åˆ»ï¼‰ <span class="optional">(ä»»æ„)</span></label>
                    <input type="time" id="gachaDeadlineTime" value="23:59">
                </div>
                <div class="form-group">
                    <label for="birthdate">ç”Ÿå¹´æœˆæ—¥ <span class="optional">(ä»»æ„)</span></label>
                    <input type="date" id="birthdate" max="2010-12-31">
                </div>
                <div class="form-group">
                    <label for="zodiac">æ˜Ÿåº§ <span class="optional">(ä»»æ„)</span></label>
                    <select id="zodiac">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ç‰¡ç¾Šåº§">ç‰¡ç¾Šåº§</option><option value="ç‰¡ç‰›åº§">ç‰¡ç‰›åº§</option>
                        <option value="åŒå­åº§">åŒå­åº§</option><option value="èŸ¹åº§">èŸ¹åº§</option>
                        <option value="ç…å­åº§">ç…å­åº§</option><option value="ä¹™å¥³åº§">ä¹™å¥³åº§</option>
                        <option value="å¤©ç§¤åº§">å¤©ç§¤åº§</option><option value="è åº§">è åº§</option>
                        <option value="å°„æ‰‹åº§">å°„æ‰‹åº§</option><option value="å±±ç¾Šåº§">å±±ç¾Šåº§</option>
                        <option value="æ°´ç“¶åº§">æ°´ç“¶åº§</option><option value="é­šåº§">é­šåº§</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bloodType">è¡€æ¶²å‹ <span class="optional">(ä»»æ„)</span></label>
                    <select id="bloodType">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="Aå‹">Aå‹</option><option value="Bå‹">Bå‹</option>
                        <option value="Oå‹">Oå‹</option><option value="ABå‹">ABå‹</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="eto">å¹²æ”¯ <span class="optional">(ä»»æ„)</span></label>
                    <select id="eto">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="å­">å­ï¼ˆã­ãšã¿ï¼‰</option><option value="ä¸‘">ä¸‘ï¼ˆã†ã—ï¼‰</option>
                        <option value="å¯…">å¯…ï¼ˆã¨ã‚‰ï¼‰</option><option value="å¯">å¯ï¼ˆã†ã•ãï¼‰</option>
                        <option value="è¾°">è¾°ï¼ˆãŸã¤ï¼‰</option><option value="å·³">å·³ï¼ˆã¸ã³ï¼‰</option>
                        <option value="åˆ">åˆï¼ˆã†ã¾ï¼‰</option><option value="æœª">æœªï¼ˆã²ã¤ã˜ï¼‰</option>
                        <option value="ç”³">ç”³ï¼ˆã•ã‚‹ï¼‰</option><option value="é…‰">é…‰ï¼ˆã¨ã‚Šï¼‰</option>
                        <option value="æˆŒ">æˆŒï¼ˆã„ã¬ï¼‰</option><option value="äº¥">äº¥ï¼ˆã„ã®ã—ã—ï¼‰</option>
                    </select>
                </div>
                <button type="submit">âœ¨ å ã† âœ¨</button>
            </form>
        </div>

        <div class="card loading" id="loading">
            <div class="spinner"></div>
            <p style="text-align:center;color:var(--primary);font-size:1.2rem;">å ã„ä¸­...</p>
        </div>

        <div class="card result" id="result"></div>

        <footer>
            <p>Powered by ã‚¯ãƒˆã¡ã‚ƒã‚“ ğŸ’« å…¨å è¡“çµ±åˆã‚·ã‚¹ãƒ†ãƒ </p>
            <p style="margin-top:10px;font-size:.8rem;">è¥¿æ´‹å æ˜Ÿè¡“ãƒ»æ•°ç§˜è¡“ãƒ»ã‚¿ãƒ­ãƒƒãƒˆãƒ»å››æŸ±æ¨å‘½ãƒ»ä¹æ˜Ÿæ°—å­¦ãƒ»å…­æ›œãƒ»è¡€æ¶²å‹å ã„ã‚’çµ±åˆ</p>
        </footer>
    </div>

    <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       æ­£ç¢ºãªå è¡“è¨ˆç®—ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    // â”€â”€ å…­æ›œï¼ˆæ—§æš¦ãƒ™ãƒ¼ã‚¹ãƒ»Math.floorä½¿ç”¨ã§æ™‚åˆ»ã‚ºãƒ¬é˜²æ­¢ï¼‰ â”€â”€
    function getLunarMonthDay(date) {
        const REF = new Date(2026, 1, 17); // æ˜¥ç¯€=æ—§æš¦æ­£æœˆ1æ—¥
        const MONTH_DAYS = [30,29,30,30,29,30,29,30,29,30,30,29];
        const diff = Math.floor((date - REF) / 86400000); // floorã§å¤•æ–¹ä»¥é™ã®ã‚ºãƒ¬ã‚’é˜²æ­¢
        let m = 1, d = 1 + diff;
        if (d >= 1) {
            while (true) { const len = MONTH_DAYS[(m-1)%12]; if(d<=len)break; d-=len; m++; }
        } else {
            while (d <= 0) { m--; if(m<=0)m+=12; d+=MONTH_DAYS[(m-1)%12]; }
        }
        return [m, d];
    }
    function getRokuyo(date) {
        const [lm, ld] = getLunarMonthDay(new Date(date));
        const idx = ((lm + ld) % 6 + 6) % 6;
        const items = [
            { name:'å¤§å®‰', icon:'â—', msg:'ä¸‡äº‹ã«æœ€å‰ã€‚ã‚¬ãƒãƒ£ã«å…¨åŠ›æŠ•çƒã§ãã‚‹æ—¥ã€‚', bonus:10 },
            { name:'èµ¤å£', icon:'â–³', msg:'æ­£åˆå‰å¾Œã®ã¿å‰ã€‚11:30ã€œ12:30ãŒç‹™ã„ç›®ã€‚', bonus:-4 },
            { name:'å…ˆå‹', icon:'â—‹', msg:'åˆå‰ä¸­ãŒå‰ã€åˆå¾Œã¯å‡¶ã€‚AMä¸­ã«å¼•ãã¹ã—ã€‚', bonus:5 },
            { name:'å‹å¼•', icon:'â—‹', msg:'å‹è² äº‹ã«å‡¶ã€‚ãŸã ã—å‹ã‚’å¼•ãè¾¼ã‚€ç¸ã¯å¼·ã„ã€‚', bonus:3 },
            { name:'å…ˆè² ', icon:'â–³', msg:'åˆå¾Œã‹ã‚‰å‰è»¢æ›ã€‚15:00ä»¥é™ã®ã‚¬ãƒãƒ£ãŒâ—ã€‚', bonus:2 },
            { name:'ä»æ»…', icon:'âœ•', msg:'å…¨ã¦ãŒå‡¶ã€‚æœ¬æ—¥ã¯çŸ³ã®æ¸©å­˜ã‚’æ¨å¥¨ã€‚', bonus:-8 }
        ];
        return items[idx];
    }

    // â”€â”€ ä¹æ˜Ÿæ°—å­¦ï¼ˆç”Ÿå¹´ã®æ¡å’Œã‹ã‚‰æ­£ç¢ºã«è¨ˆç®—ï¼‰ â”€â”€
    function getKyusei(birthYear) {
        if (!birthYear) return null;
        let sum = String(birthYear).split('').map(Number).reduce((a,b)=>a+b, 0);
        while (sum >= 10) sum = String(sum).split('').map(Number).reduce((a,b)=>a+b, 0);
        let num = 11 - sum;
        if (num <= 0) num += 9;
        if (num > 9)  num -= 9;
        const names = ['','ä¸€ç™½æ°´æ˜Ÿ','äºŒé»’åœŸæ˜Ÿ','ä¸‰ç¢§æœ¨æ˜Ÿ','å››ç·‘æœ¨æ˜Ÿ','äº”é»„åœŸæ˜Ÿ','å…­ç™½é‡‘æ˜Ÿ','ä¸ƒèµ¤é‡‘æ˜Ÿ','å…«ç™½åœŸæ˜Ÿ','ä¹ç´«ç«æ˜Ÿ'];
        const msgs = {
            1:'æµã‚Œã«ä¹—ã‚‹ã“ã¨ã§é‹æ°—ãŒé–‹ãã€‚ç›´æ„Ÿã‚’ä¿¡ã˜ã¦å¼•ãã¹ã—ã€‚',
            2:'æ…é‡ãªè¡Œå‹•ãŒå‰ã‚’å‘¼ã¶ã€‚ç„¦ã‚‰ãšæœ€é©ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å¾…ã¦ã€‚',
            3:'è¡Œå‹•åŠ›ãŒæœ€å¤§ã®æ­¦å™¨ã€‚æ€ã„åˆ‡ã£ã¦ã‚¬ãƒãƒ£ã«æŒ‘æˆ¦ã›ã‚ˆã€‚',
            4:'ç¸ã¨ç¸ãŒç¹‹ãŒã‚‹æ—¥ã€‚äººã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒå¹¸é‹ã®éµã«ãªã‚‹ã€‚',
            5:'å¤‰åŒ–ã®ä¸­å¿ƒã«ã„ã‚‹ã€‚å¤§èƒ†ãªè¡Œå‹•ãŒå¤§ããªçµæœã‚’ç”Ÿã‚€ã€‚',
            6:'æ¨©å¨ã¨èª å®Ÿã•ãŒé‹ã‚’å¼•ãå¯„ã›ã‚‹ã€‚æ­£æ”»æ³•ãŒæœ€å–„ç­–ã€‚',
            7:'é‡‘é‹ã¨å¯¾äººé‹ãŒé«˜ã¾ã‚‹ã€‚æ˜ã‚‹ã„æ°—æŒã¡ã§æŒ‘ã‚€ã®ãŒå‰ã€‚',
            8:'ç©ã¿é‡ã­ãŒå®Ÿã‚‹æ™‚ã€‚è«¦ã‚ãšã«ç¶šã‘ã‚‹ã“ã¨ã§é“ãŒé–‹ã‘ã‚‹ã€‚',
            9:'æƒ…ç†±ã¨ç›´æ„ŸãŒå†´ãˆã‚‹ã€‚è¼ãã‚‚ã®ã‚’è¦‹æ¥µã‚ã‚‹çœ¼ãŒå…‰ã‚‹ã€‚'
        };
        return { star: names[num], num, msg: msgs[num] || '' };
    }

    // â”€â”€ å››æŸ±æ¨å‘½ æ—¥æŸ±ï¼ˆæ­£ç¢ºãªepochåŸºæº–: 2026/2/20=ä¹™ä¸‘ï¼‰ â”€â”€
    const STEMS    = ['ç”²','ä¹™','ä¸™','ä¸','æˆŠ','å·±','åºš','è¾›','å£¬','ç™¸'];
    const BRANCHES = ['å­','ä¸‘','å¯…','å¯','è¾°','å·³','åˆ','æœª','ç”³','é…‰','æˆŒ','äº¥'];
    const ELEM_MAP = ['æœ¨','æœ¨','ç«','ç«','åœŸ','åœŸ','é‡‘','é‡‘','æ°´','æ°´'];
    function getTodayPillar() {
        const ep = Math.floor(Date.now() / 86400000);
        const si = (ep + 7) % 10;  // stemOffset=7 (2026/2/20=ä¹™=1, ep=20504, (20504+7)%10=1 âœ“)
        const bi = (ep + 5) % 12;  // branchOffset=5 (2026/2/20=ä¸‘=1, ep=20504, (20504+5)%12=1 âœ“)
        const elem = ELEM_MAP[si];
        const elemMsg = {æœ¨:'æˆé•·ã¨ç™ºå±•ã®æ°—',ç«:'æƒ…ç†±ã¨è¡Œå‹•åŠ›ã®æ°—',åœŸ:'å®‰å®šã¨åç©«ã®æ°—',é‡‘:'æ¨©å¨ã¨é‡‘é‹ã®æ°—',æ°´:'æµã‚Œã¨ç›´æ„Ÿã®æ°—'};
        return { pillar: STEMS[si]+BRANCHES[bi], stem: STEMS[si], branch: BRANCHES[bi], elem, elemMsg: elemMsg[elem] };
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ã‚²ãƒ¼ãƒ ã‚¿ã‚¤ãƒˆãƒ«åˆ¥ã‚ªã‚«ãƒ«ãƒˆæƒ…å ±DB
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const gameOccultData = {
        'ã‚¦ãƒå¨˜':    { luckyDays:[3], luckyHours:[5,6,7,18,19], jinxes:['æ°´æ›œ18:00æ›´æ–°ç›´å¾ŒãŒç†±ã„','æœ5:00-7:00ã«å¥‡è·¡å ±å‘Šå¤šæ•°','æº€æœˆã®å¤œã¯ç¢ºç‡ã‚¢ãƒƒãƒ—èª¬'] },
        'ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–': { luckyDays:[1], luckyHours:[2,3,4,11,22], jinxes:['æœˆæ›œãƒ¡ãƒ³ãƒ†å¾ŒãŒç‹™ã„ç›®','æ·±å¤œ2:00-4:00ã®ã‚¾ãƒ¼ãƒ³','ã‚¾ãƒ­ç›®æ™‚åˆ»ï¼ˆ11:11,22:22ï¼‰ãŒæ¿€ã‚¢ãƒ„'] },
        'å´©å£Šï¼šã‚¹ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ«': { luckyDays:[4], luckyHours:[6,7,8,18], jinxes:['æœ¨æ›œæ›´æ–°ãŒåŸºæœ¬','æœ6:00-8:00ãŒå‡ºã‚„ã™ã„','èª²é‡‘ç›´å¾Œ30åˆ†ã¯é¿ã‘ã‚‹ã¹ã—'] },
        'NIKKE':     { luckyDays:[5], luckyHours:[19,20,21], jinxes:['é‡‘æ›œå¤œãŒç†±ã„','19:00-21:00ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','ãƒ¡ãƒ³ãƒ†æ˜ã‘1æ™‚é–“ä»¥å†…'] },
        'åŸç¥':      { luckyDays:[2], luckyHours:[0,18,19,20], jinxes:['ç«æ›œ18:00æ›´æ–°','æ›´æ–°ã‹ã‚‰3æ™‚é–“ä»¥å†…ãŒå‹è² ','æ·±å¤œ0:00ã‚¸ãƒ£ã‚¹ãƒˆãŒå¥‡è·¡'] },
        'Fate/GO':   { luckyDays:[3,6], luckyHours:[12,18,21], jinxes:['ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—åˆæ—¥ãŒæœ€ã‚‚ç†±ã„','21:00å‰å¾Œã«å ±å‘Šå¤šæ•°','0æ™‚å›ã—ã¯éƒ½å¸‚ä¼èª¬'] },
        'ã‚¼ãƒ³ãƒ¬ã‚¹ã‚¾ãƒ¼ãƒ³ã‚¼ãƒ­': { luckyDays:[3,4], luckyHours:[11,18,19,20], jinxes:['æ°´æ›œãƒ¡ãƒ³ãƒ†å¾ŒãŒæ¿€ã‚¢ãƒ„','18:00-20:00ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','11:11ã®ã‚¾ãƒ­ç›®æ™‚åˆ»ãŒå¥‡è·¡ã‚’å‘¼ã¶'] },
        'LINE MF':   { luckyDays:[2,5], luckyHours:[12,18,21,22], jinxes:['ç«æ›œãƒ»é‡‘æ›œã®æ›´æ–°ç›´å¾Œ','22:22ã®ã‚¾ãƒ­ç›®ãŒå¹¸é‹','æ·±å¤œã‚ˆã‚Šã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ '] },
        'Echocalypse': { luckyDays:[4,5], luckyHours:[0,6,7,18,19], jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†å¾Œ1æ™‚é–“','æœ6:00-7:00ã®æ—©æœã‚¾ãƒ¼ãƒ³','æ·±å¤œ0:00ãƒªã‚»ãƒƒãƒˆç›´å¾Œ'] },
        'Evertale':  { luckyDays:[1,5], luckyHours:[3,12,18,21], jinxes:['æœˆæ›œãƒ»é‡‘æ›œãŒç‹™ã„ç›®','æ·±å¤œ3:00ã®é­”ã®æ™‚é–“','18:00-21:00ãŒå®‰å®š'] },
        'PokÃ©mon Trading Card Game Pocket': { luckyDays:[2,5], luckyHours:[7,8,12,18,19], jinxes:['æœ7:00-8:00ã®ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‘ãƒƒã‚¯','ç«æ›œãƒ»é‡‘æ›œã®æ–°å¼¾è¿½åŠ ç›´å¾Œ','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆ'] },
        'é³´æ½®':      { luckyDays:[4], luckyHours:[6,11,18,19,20], jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†å¾ŒãŒç‹™ã„ç›®','æœ6:00ã®æ—©æœã‚¬ãƒãƒ£','18:00-20:00ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ '] },
        'ãƒ—ãƒªã‚³ãƒR':  { luckyDays:[1,5], luckyHours:[5,12,18,19], jinxes:['æœˆæ›œ5:00ã‚¬ãƒãƒ£æ›´æ–°ç›´å¾Œ','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆ','é‡‘æ›œå¤œãŒç†±ã„'] },
        'ã‚°ãƒ©ãƒ–ãƒ«':   { luckyDays:[1,4], luckyHours:[12,17,19,22], jinxes:['æœˆæ›œ12:00ãƒ¬ã‚¸ã‚§ãƒ•ã‚§ã‚¹é–‹å§‹','17:00ã¨19:00ã®ãƒã‚°ãƒŠã‚¿ã‚¤ãƒ ','22:00ã®æ·±å¤œã‚¬ãƒãƒ£'] },
        'ã‚¢ã‚ºãƒ¼ãƒ«ãƒ¬ãƒ¼ãƒ³': { luckyDays:[4], luckyHours:[0,5,12,18], jinxes:['æœ¨æ›œãƒ¡ãƒ³ãƒ†æ˜ã‘','æ·±å¤œ0:00ãƒ‡ã‚¤ãƒªãƒ¼ãƒªã‚»ãƒƒãƒˆ','12:00æ˜¼ä¼‘ã¿ã‚¬ãƒãƒ£'] },
        'ãƒ˜ãƒ–ãƒãƒ³':   { luckyDays:[2,5], luckyHours:[11,15,18,21], jinxes:['ç«æ›œ15:00æ›´æ–°ç›´å¾Œ','18:00-21:00ã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ ','é‡‘æ›œå¤œãŒå½“ãŸã‚Šã‚„ã™ã„'] },
        'DQã‚¦ã‚©ãƒ¼ã‚¯': { luckyDays:[1,5], luckyHours:[6,12,15,18], jinxes:['é‡‘æ›œ15:00ã‚¬ãƒãƒ£æ›´æ–°','æœ6:00ã®æ•£æ­©ã‚¬ãƒãƒ£','12:00ã¨18:00ã®ãƒ‡ã‚¤ãƒªãƒ¼'] },
        'ç™½çŒ«':      { luckyDays:[1,4], luckyHours:[12,15,18,21], jinxes:['æœˆæ›œ15:00ã‚¬ãƒãƒ£æ›´æ–°','12:00æ˜¼ä¼‘ã¿','21:00å¤œã®ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¿ã‚¤ãƒ '] }
    };

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       åˆæœŸåŒ–
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    (function createStars() {
        const c = document.getElementById('stars');
        for (let i=0;i<100;i++) {
            const s=document.createElement('div'); s.className='star';
            s.style.left=Math.random()*100+'%'; s.style.top=Math.random()*100+'%';
            s.style.animationDelay=Math.random()*3+'s'; c.appendChild(s);
        }
    })();

    document.getElementById('gachaDeadline').min = new Date().toISOString().split('T')[0];
    document.getElementById('gameTitle').addEventListener('change', function() {
        const g=document.getElementById('customGameGroup'), i=document.getElementById('customGame');
        if(this.value==='ãã®ä»–'){g.style.display='block';i.required=true;}
        else{g.style.display='none';i.required=false;i.value='';}
    });

    document.getElementById('fortuneForm').addEventListener('submit', function(e) {
        e.preventDefault();
        let gameTitle = document.getElementById('gameTitle').value;
        if (gameTitle==='ãã®ä»–') gameTitle=document.getElementById('customGame').value;
        const params = {
            gameTitle,
            targetName: document.getElementById('targetName').value,
            gachaTitle: document.getElementById('gachaTitle').value,
            gachaDeadline: document.getElementById('gachaDeadline').value,
            gachaDeadlineTime: document.getElementById('gachaDeadlineTime').value,
            birthdate: document.getElementById('birthdate').value,
            zodiac: document.getElementById('zodiac').value,
            bloodType: document.getElementById('bloodType').value,
            eto: document.getElementById('eto').value
        };
        document.getElementById('loading').classList.add('show');
        document.getElementById('result').classList.remove('show');
        setTimeout(() => {
            const result = calculateFortune(params);
            displayResult(result);
            document.getElementById('loading').classList.remove('show');
            document.getElementById('result').classList.add('show');
            document.getElementById('result').scrollIntoView({ behavior:'smooth', block:'start' });
        }, 2000);
    });

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ãƒ¡ã‚¤ãƒ³å ã„è¨ˆç®—
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function calculateFortune(params) {
        const { gameTitle, targetName, gachaTitle, gachaDeadline, gachaDeadlineTime, birthdate, zodiac, bloodType, eto } = params;
        const now = new Date();

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèª
        const savedKey = `${gameTitle}_${targetName}_${gachaTitle}_${gachaDeadline}`;
        const fixedResult = localStorage.getItem('fixedGachaResult');
        const fixedResultKey = localStorage.getItem('fixedGachaResultKey');
        if (fixedResult && fixedResultKey === savedKey) {
            try { return JSON.parse(fixedResult); } catch(e){}
        }

        // åŸºæœ¬ã‚¹ã‚³ã‚¢
        let baseScore = 70 + Math.floor(Math.random() * 20);
        if (birthdate) { const b=new Date(birthdate); baseScore+=(b.getDate()%10); }
        if (zodiac) {
            const zb={'ç‰¡ç¾Šåº§':5,'ç‰¡ç‰›åº§':3,'åŒå­åº§':7,'èŸ¹åº§':4,'ç…å­åº§':6,'ä¹™å¥³åº§':5,'å¤©ç§¤åº§':4,'è åº§':8,'å°„æ‰‹åº§':7,'å±±ç¾Šåº§':5,'æ°´ç“¶åº§':6,'é­šåº§':4};
            baseScore+=(zb[zodiac]||0);
        }
        if (bloodType) { const bb={'Aå‹':3,'Bå‹':5,'Oå‹':4,'ABå‹':6}; baseScore+=(bb[bloodType]||0); }
        if (targetName) baseScore+=(targetName.length%5)+3;
        if (gachaTitle) baseScore+=2;

        // â”€â”€ æ­£ç¢ºãªå è¡“ãƒ‡ãƒ¼ã‚¿å–å¾— â”€â”€
        const rokuyoData   = getRokuyo(now);                                            // å…­æ›œï¼ˆæ—§æš¦ï¼‰
        const birthYear    = birthdate ? parseInt(birthdate.split('-')[0]) : null;
        const kyuseiData   = getKyusei(birthYear);                                      // ä¹æ˜Ÿæ°—å­¦ï¼ˆç”Ÿå¹´ï¼‰
        const dayPillarData = getTodayPillar();                                          // å››æŸ±æ¨å‘½ æ—¥æŸ±

        // å…­æ›œãƒœãƒ¼ãƒŠã‚¹ã‚’ã‚¹ã‚³ã‚¢ã«åŠ ç®—
        baseScore += rokuyoData.bonus;
        baseScore = Math.min(100, Math.max(50, baseScore));

        const luckyTimes = generateLuckyTimes(now.getMonth()+1, baseScore, targetName, gachaDeadline, gachaDeadlineTime, gameTitle);
        const divinations = generateDivinations({ gameTitle, targetName, gachaTitle, zodiac, bloodType, eto, baseScore, rokuyoData, kyuseiData, dayPillarData });
        const luckyActions = generateLuckyActions(baseScore, targetName, gachaTitle);
        const recommendedPulls = calculateRecommendedPulls(baseScore, targetName);

        const result = { gameTitle, targetName, gachaTitle, gachaDeadline, gachaDeadlineTime, score:baseScore, recommendedPulls, luckyTimes, divinations, luckyActions, timestamp:now.getTime() };
        localStorage.setItem('lastGachaFortune', JSON.stringify(result));
        localStorage.setItem('fixedGachaResult', JSON.stringify(result));
        localStorage.setItem('fixedGachaResultKey', savedKey);
        return result;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       å è¡“åˆ¥è§£èª¬ç”Ÿæˆï¼ˆæ­£ç¢ºãªè¨ˆç®—å€¤ä½¿ç”¨ï¼‰
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function generateDivinations({ gameTitle, targetName, gachaTitle, zodiac, bloodType, eto, baseScore, rokuyoData, kyuseiData, dayPillarData }) {
        const divinations = [];

        // è¥¿æ´‹å æ˜Ÿè¡“
        let astrology = `${zodiac||'æ˜Ÿåº§æƒ…å ±ãªã—'}ã®æ–¹ã¯ã€`;
        if (baseScore>=85) astrology+='ç¾åœ¨ã€å¹¸é‹ã®æ˜ŸãŒå¼·ãè¼ã„ã¦ã„ã¾ã™ã€‚é‡‘æ˜Ÿã¨æœ¨æ˜Ÿã®è‰¯ã„é…ç½®ã«ã‚ˆã‚Šã€ã‚¬ãƒãƒ£é‹ãŒæœ€é«˜æ½®ã«é”ã—ã¦ã„ã¾ã™ã€‚';
        else if (baseScore>=70) astrology+='é‹æ°—ã¯å®‰å®šã—ã¦ãŠã‚Šã€æœˆã®å½±éŸ¿ã§ç›´æ„ŸãŒå†´ãˆã¦ã„ã¾ã™ã€‚ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹æ¥µã‚ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚';
        else astrology+='é‹æ°—ã¯ç©ã‚„ã‹ã§ã™ãŒã€æ°´æ˜Ÿã®é€†è¡Œã«ã‚ˆã‚Šæ…é‡ã•ãŒå¿…è¦ã§ã™ã€‚ç„¦ã‚‰ãšãƒãƒ£ãƒ³ã‚¹ã‚’å¾…ã¡ã¾ã—ã‚‡ã†ã€‚';
        if (gachaTitle&&targetName) astrology+=`ã€Œ${gachaTitle}ã€ã§ã®ã€Œ${targetName}ã€ã¨ã®ç¸ã¯ã€ç¬¬1å€™è£œã®æ™‚é–“å¸¯ã«æœ€ã‚‚å¼·ã¾ã‚Šã¾ã™ã€‚`;
        else if (targetName) astrology+=`ç‰¹ã«ã€Œ${targetName}ã€ã¨ã®ç¸ã¯ã€ç¬¬1å€™è£œã®æ™‚é–“å¸¯ã«å¼·ã¾ã‚Šã¾ã™ã€‚`;
        else if (gachaTitle) astrology+=`ã€Œ${gachaTitle}ã€ã®æœŸé–“ã¯ã€é‹å‘½ã®æ˜Ÿã®é…ç½®ãŒè‰¯å¥½ã§ã™ã€‚`;
        divinations.push({ title:'ğŸŒŸ è¥¿æ´‹å æ˜Ÿè¡“', content:astrology });

        // æ•°ç§˜è¡“
        let numerology = `ã‚²ãƒ¼ãƒ ã€Œ${gameTitle}ã€ã®æ•°å€¤æ³¢å‹•ã‚’åˆ†æã™ã‚‹ã¨ã€ä»Šæœˆã¯ã‚¨ãƒãƒ«ã‚®ãƒ¼å€¤ãŒé«˜ãã€ç‰¹ã«${[3,7,8,9,11,22,33][Math.floor(Math.random()*7)]}ã®æ•°å­—ãŒå¹¸é‹ã‚’å‘¼ã³ã¾ã™ã€‚`;
        if (gachaTitle) numerology+=`ã€Œ${gachaTitle}ã€ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ã¯${gachaTitle.length}æ–‡å­—ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå®¿ã£ã¦ãŠã‚Šã€`;
        if (targetName) numerology+=`ã€Œ${targetName}ã€ã®åå‰ã«ã¯${targetName.length}æ–‡å­—ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒå®¿ã£ã¦ãŠã‚Šã€ã“ã®æ•°å­—ã‚’æ„è­˜ã™ã‚‹ã¨å¼•ãå¯„ã›åŠ›ãŒé«˜ã¾ã‚Šã¾ã™ã€‚`;
        else numerology+='ã“ã®æ•°å­—ã‚’æ„è­˜ã—ã¦ã‚¬ãƒãƒ£ã‚’å¼•ãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚';
        divinations.push({ title:'ğŸ”¢ æ•°ç§˜è¡“', content:numerology });

        // ã‚¿ãƒ­ãƒƒãƒˆ
        let tarot = '';
        if (gachaTitle&&targetName) tarot=`ã€Œ${gachaTitle}ã€ã§ã€Œ${targetName}ã€ã‚’æ±‚ã‚ã‚‹ã‚ãªãŸã«ã¯ã€ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€Œé‹å‘½ã®è¼ªã€ã¨ã€Œæ‹äººã€ãŒåŒæ™‚ã«å‡ºç¾ã€‚ã“ã‚Œã¯æ¥µã‚ã¦ç¨€ãªå¼·é‹ã®æš—ç¤ºã§ã™ã€‚`;
        else if (targetName) tarot=`ã€Œ${targetName}ã€ã‚’æ±‚ã‚ã‚‹ã‚ãªãŸã«ã¯ã€ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€Œæ‹äººã€ãŒå‡ºç¾ã€‚å¼·ã„ç¸ã¨å¼•ãå¯„ã›ã®åŠ›ãŒåƒã„ã¦ã„ã¾ã™ã€‚`;
        else if (gachaTitle) tarot=`ã€Œ${gachaTitle}ã€ã®æœŸé–“ã€ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€Œå¤ªé™½ã€ãŒè¼ã„ã¦ã„ã¾ã™ã€‚æˆåŠŸã¨å–œã³ã®æš—ç¤ºã§ã™ã€‚`;
        else if (baseScore>=80) tarot='ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€Œæ˜Ÿã€ãŒç¤ºç¾ã€‚å¸Œæœ›ã¨å¹¸é‹ã®æš—ç¤ºã§ã™ã€‚é¡˜ã„ãŒå¶ã†å¯èƒ½æ€§ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚';
        else tarot='ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã€Œé‹å‘½ã®è¼ªã€ãŒå‡ºç¾ã€‚å¤‰åŒ–ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã§è‰¯ã„çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚';
        divinations.push({ title:'ğŸ´ ã‚¿ãƒ­ãƒƒãƒˆå ã„', content:tarot });

        // å…­æ›œï¼ˆæ­£ç¢ºãªæ—§æš¦è¨ˆç®—ï¼‰
        const rokuyoContent = `æœ¬æ—¥ã®å…­æ›œã¯ã€${rokuyoData.name}ã€‘${rokuyoData.icon}ã€‚${rokuyoData.msg}${baseScore>=80?' é‹æ°—ã‚¹ã‚³ã‚¢ã¨ã®ç›¸ä¹—åŠ¹æœã§ã€ãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ã®å¼•ãå¯„ã›åŠ›ãŒå¢—å¹…ã—ã¦ã„ã¾ã™ã€‚':''}`;
        divinations.push({ title:'ğŸ“… å…­æ›œ', content:rokuyoContent });

        // ä¹æ˜Ÿæ°—å­¦ãƒ»å››æŸ±æ¨å‘½ï¼ˆæ­£ç¢ºãªè¨ˆç®—ï¼‰
        let kyuseiContent = '';
        if (kyuseiData) {
            kyuseiContent = `æœ¬å‘½æ˜Ÿã€${kyuseiData.star}ã€‘ã€‚${kyuseiData.msg} ä»Šæ—¥ã®æ—¥æŸ±ã€${dayPillarData.pillar}ã€‘ã¨ã®çµ„ã¿åˆã‚ã›ã§ã€${dayPillarData.elemMsg}ãŒç‰¹ã«å¼·ãåƒã„ã¦ã„ã¾ã™ã€‚`;
            if (eto) kyuseiContent+=` ${eto}å¹´ç”Ÿã¾ã‚Œã®æ–¹ã¯ã€ã“ã®æ˜Ÿã®é…ç½®ã§ã€Œæ¡ƒèŠ±é‹ã€ã¨ã€Œè²¡é‹ã€ãŒé‡ãªã‚‹å‰æ—¥ã§ã™ã€‚`;
        } else {
            kyuseiContent = `ä»Šæ—¥ã®æ—¥æŸ±ã€${dayPillarData.pillar}ã€‘ã¯${dayPillarData.elemMsg}ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚ç©æ¥µçš„ãªè¡Œå‹•ãŒå‰ã‚’å‘¼ã³ã¾ã™ã€‚`;
            if (eto) kyuseiContent+=` ${eto}å¹´ã®æ–¹ã¯ã€ä»Šæœˆã®é‹æ°—ã¯ä¸Šæ˜‡å‚¾å‘ã«ã‚ã‚Šã¾ã™ã€‚`;
        }
        if (gachaTitle&&targetName) kyuseiContent+=` ã€Œ${gachaTitle}ã€ã§ã®ã€Œ${targetName}ã€ã¨ã®ç¸ã¯ã€å¤©ãŒå®šã‚ãŸé‹å‘½ã§ã™ã€‚`;
        else if (targetName) kyuseiContent+=` ã€Œ${targetName}ã€ã¨ã®ç¸ã¯å¤©ã‹ã‚‰å®šã‚ã‚‰ã‚ŒãŸã‚‚ã®ã€‚è«¦ã‚ãšã«æŒ‘æˆ¦ã—ç¶šã‘ã‚‹ã“ã¨ã§ã€å¿…ãšæ‰‹ã«å…¥ã‚Šã¾ã™ã€‚`;
        divinations.push({ title:'â˜¯ï¸ ä¹æ˜Ÿæ°—å­¦ãƒ»å››æŸ±æ¨å‘½', content:kyuseiContent });

        // è¡€æ¶²å‹
        const blood = bloodType ? `${bloodType}ã®æ–¹ã¯ã€${{ 'Aå‹':'æ…é‡ãªæ€§æ ¼ãŒå‰ã¨å‡ºã¾ã™ã€‚è¨ˆç”»çš„ã«ã‚¬ãƒãƒ£ã‚’å¼•ãã“ã¨ã§ã€é«˜ãƒ¬ã‚¢ãƒªãƒ†ã‚£ã‚’å¼•ãå½“ã¦ã‚‹å¯èƒ½æ€§ãŒé«˜ã¾ã‚Šã¾ã™ã€‚', 'Bå‹':'ç›´æ„ŸåŠ›ãŒå†´ãˆã¦ã„ã¾ã™ã€‚ã€Œå¼•ããŸã„ã€ã¨æ€ã£ãŸç¬é–“ãŒãƒ™ã‚¹ãƒˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã™ã€‚è¿·ã‚ãšè¡Œå‹•ã—ã¾ã—ã‚‡ã†ã€‚', 'Oå‹':'å¤§èƒ†ã•ãŒå¹¸é‹ã‚’å‘¼ã³ã¾ã™ã€‚æ€ã„åˆ‡ã£ã¦ã‚¬ãƒãƒ£ã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨ã§ã€äºˆæƒ³ä»¥ä¸Šã®çµæœãŒå¾—ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚', 'ABå‹':'ç‹¬ç‰¹ã®æ„Ÿæ€§ãŒæ­¦å™¨ã§ã™ã€‚ä»–ã®äººãŒå¼•ã‹ãªã„æ™‚é–“å¸¯ã«å¼•ãã“ã¨ã§ã€ãƒ¬ã‚¢ãªçµæœã‚’å¾—ã‚„ã™ããªã‚Šã¾ã™ã€‚' }[bloodType]||''}` : 'è¡€æ¶²å‹æƒ…å ±ãŒã‚ã‚Œã°ã€ã•ã‚‰ã«è©³ç´°ãªé‘‘å®šãŒå¯èƒ½ã§ã™ã€‚';
        divinations.push({ title:'ğŸ©¸ è¡€æ¶²å‹å ã„', content:blood });

        return divinations;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ãƒ©ãƒƒã‚­ãƒ¼ã‚¿ã‚¤ãƒ ãƒ»æ¨å¥¨å›æ•°è¨ˆç®—
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function generateLuckyTimes(month, score, targetName, deadline, deadlineTime, gameTitle) {
        const times=[], now=new Date(), today=now.getDate();
        const occ=gameOccultData[gameTitle]||{};
        const calcPinpoint=(h,r)=>{let m=(h===11||h===22)?h:[7,17,27,33,37,47,57][r%7];return `${h}:${String(m).padStart(2,'0')}`;};
        const calcTen=(s,r)=>{if(r===0&&s>=90)return 3;if(r===0)return 2;if(r<=2)return 2;return 1;};
        const selHour=(r)=>occ.luckyHours?occ.luckyHours[r%occ.luckyHours.length]:null;
        const findLucky=(td,dl)=>{for(let o=0;o<7;o++){const t=new Date(td);t.setDate(t.getDate()+o);if(t>dl)break;if((occ.luckyDays||[]).includes(t.getDay()))return t;}return td;};

        if (deadline) {
            let dl=new Date(deadline);
            if(deadlineTime){const[h,m]=deadlineTime.split(':');dl.setHours(parseInt(h),parseInt(m),0,0);}
            else dl.setHours(23,59,59,999);
            const diffH=Math.ceil((dl-now)/3600000), diffD=Math.ceil((dl-now)/86400000);

            if (diffH<=0) {
                for(let i=0;i<5;i++){const h=(now.getHours()+i+1)%24;times.push({rank:i+1,date:`${month}æœˆ${today}æ—¥`,time:`${h}:00 - ${(h+2)%24}:00`,pinpoint:calcPinpoint(h,i),score:score-(i*3),tenPulls:calcTen(score,i),special:!!(targetName&&i===0),urgent:true,passed:false});}
            } else if (diffH<=24) {
                const intv=Math.max(1,Math.floor(Math.min(diffH,24)/5));
                for(let i=0;i<5;i++){const ft=new Date(now.getTime()+(intv*i+1)*3600000);if(ft>dl)break;const h=ft.getHours();times.push({rank:i+1,date:`${ft.getMonth()+1}æœˆ${ft.getDate()}æ—¥`,time:`${h}:00 - ${(h+2)%24}:00`,pinpoint:calcPinpoint(h,i),score:score-(i*3),tenPulls:calcTen(score,i),special:!!(targetName&&i===0),urgent:i===0,passed:false});}
            } else {
                const intv=Math.max(1,Math.floor(diffD/5));
                for(let i=0;i<5;i++){
                    let td=new Date(now);td.setDate(td.getDate()+(intv*i)+Math.floor(Math.random()*Math.max(1,intv)));
                    if(occ.luckyDays&&i<2)td=findLucky(td,dl);
                    if(td>dl){td=new Date(dl);td.setHours(td.getHours()-(i*2));}
                    if(td<now){td=new Date(now);td.setHours(now.getHours()+i+1);}
                    let h=selHour(i); if(h===null)h=td.getHours();
                    let ts=score-(i*3); if(targetName&&i===0)ts+=3;
                    times.push({rank:i+1,date:`${td.getMonth()+1}æœˆ${td.getDate()}æ—¥`,time:`${h}:00 - ${(h+2)%24}:00`,pinpoint:calcPinpoint(h,i),score:ts,tenPulls:calcTen(score,i),special:!!(targetName&&i===0),urgent:false,passed:false});
                }
            }
        } else {
            const dim=new Date(now.getFullYear(),month,0).getDate();
            for(let i=0;i<5;i++){
                let day=today+Math.floor(Math.random()*14)+1; if(day>dim)day-=dim;
                let h=selHour(i)||Math.floor(Math.random()*24);
                let ts=score-(i*3); if(targetName&&i===0)ts+=3;
                times.push({rank:i+1,date:`${month}æœˆ${day}æ—¥`,time:`${h}:00 - ${(h+2)%24}:00`,pinpoint:calcPinpoint(h,i),score:ts,tenPulls:calcTen(score,i),special:!!(targetName&&i===0),urgent:false,passed:false});
            }
        }
        return times;
    }

    function calculateRecommendedPulls(score, targetName) {
        let p={single:0,ten:0,total:0};
        if(score>=90){p.single=Math.floor(Math.random()*3)+1;p.ten=Math.floor(Math.random()*2)+2;}
        else if(score>=80){p.single=Math.floor(Math.random()*2)+1;p.ten=Math.floor(Math.random()*2)+2;}
        else if(score>=70){p.single=Math.floor(Math.random()*2);p.ten=Math.floor(Math.random()*2)+1;}
        else{p.single=0;p.ten=1;}
        if(targetName)p.ten+=1;
        p.total=p.single+(p.ten*10);
        return p;
    }

    function generateLuckyActions(score, targetName, gachaTitle) {
        const a=['ã‚¬ãƒãƒ£ã‚’å¼•ãå‰ã«ã€æ·±å‘¼å¸ã‚’3å›ã—ã¦ãƒªãƒ©ãƒƒã‚¯ã‚¹ã—ã¾ã—ã‚‡ã†','ç”»é¢ã‚’ç¶ºéº—ã«æ‹­ã„ã¦ã€é‹æ°—ã®é€šã‚Šé“ã‚’æ•´ãˆã¾ã—ã‚‡ã†','å¥½ããªéŸ³æ¥½ã‚’è´ã„ã¦ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªæ°—æŒã¡ã‚’é«˜ã‚ã¾ã—ã‚‡ã†','éƒ¨å±‹ã®æƒé™¤ã‚’ã—ã¦ã€é‹æ°—ã®æµã‚Œã‚’è‰¯ãã—ã¾ã—ã‚‡ã†','ç¥ç¤¾ã‚„ãŠå¯ºã®ç”»åƒã‚’è¦‹ã¦ã€å¿ƒã‚’è½ã¡ç€ã‘ã¾ã—ã‚‡ã†'];
        if(score>=85)a.push('ä»Šã¯æœ€é«˜ã®é‹æ°—ã§ã™ã€‚è‡ªä¿¡ã‚’æŒã£ã¦ã‚¬ãƒãƒ£ã«è‡¨ã¿ã¾ã—ã‚‡ã†');
        if(gachaTitle&&targetName){a.push(`ã€Œ${gachaTitle}ã€ã®ã€Œ${targetName}ã€ã®åå‰ã‚’3å›å”±ãˆã¦ã‹ã‚‰å¼•ãã¾ã—ã‚‡ã†`);a.push(`ã€Œ${targetName}ã€ã®ç”»åƒã‚’å¾…ã¡å—ã‘ã«ã—ã¦ã€å¼•ãå¯„ã›ãƒ‘ãƒ¯ãƒ¼ã‚’é«˜ã‚ã¾ã—ã‚‡ã†`);a.push(`ã€Œ${gachaTitle}ã€ã®ãƒãƒŠãƒ¼ã‚’è¦‹ã¤ã‚ã¦ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å¼·ãæŒã¡ã¾ã—ã‚‡ã†`);}
        else if(targetName){a.push(`ã€Œ${targetName}ã€ã®åå‰ã‚’3å›å”±ãˆã¦ã‹ã‚‰å¼•ãã¾ã—ã‚‡ã†`);a.push(`ã€Œ${targetName}ã€ã®ç”»åƒã‚’å¾…ã¡å—ã‘ã«ã—ã¦ã€å¼•ãå¯„ã›ãƒ‘ãƒ¯ãƒ¼ã‚’é«˜ã‚ã¾ã—ã‚‡ã†`);}
        else if(gachaTitle)a.push(`ã€Œ${gachaTitle}ã€ã®æˆåŠŸã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãªãŒã‚‰å¼•ãã¾ã—ã‚‡ã†`);
        return a;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       çµæœè¡¨ç¤º
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function displayResult(result) {
        const rd = document.getElementById('result');
        let html = `<div class="lucky-time"><h2>ğŸ¯ ${result.gameTitle} ã®æœ€é©ã‚¬ãƒãƒ£æ™‚åˆ»</h2>`;
        if(result.gachaTitle) html+=`<div style="margin:10px 0;font-size:1.2rem;font-weight:700;color:#FF6B6B;">ğŸ“… ${result.gachaTitle}</div>`;
        if(result.gachaDeadline){const dl=new Date(result.gachaDeadline);html+=`<div style="margin:10px 0;font-size:1rem;color:#FF4500;">â° æœŸé™: ${dl.getMonth()+1}æœˆ${dl.getDate()}æ—¥ ${result.gachaDeadlineTime||'23:59'}ã¾ã§</div>`;}
        if(result.targetName) html+=`<div style="margin:15px 0;font-size:1.1rem;font-weight:600;">ğŸ¯ ç‹™ã„: ${result.targetName}</div>`;
        html+='</div>';

        if(!result.luckyTimes.filter(t=>!t.passed).length) html+=`<div style="background:#FFF3CD;padding:15px;border-radius:10px;margin:15px 0;border-left:5px solid #FFA500;"><p style="color:#856404;margin:0;">âš ï¸ æç¤ºã•ã‚ŒãŸæ™‚é–“ãŒéãã¾ã—ãŸã€‚å†åº¦å ã„ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p></div>`;

        result.luckyTimes.forEach(t=>{
            let b='',s='';
            if(t.passed){b='<span style="background:#999;color:white;padding:5px 10px;border-radius:5px;font-size:.8rem;margin-left:10px;">â°çµ‚äº†</span>';s='opacity:.5;';}
            else{if(t.special)b+='<span style="background:#FF4500;color:white;padding:5px 10px;border-radius:5px;font-size:.8rem;margin-left:10px;">âœ¨ç‰¹åˆ¥</span>';if(t.urgent)b+='<span style="background:#DC143C;color:white;padding:5px 10px;border-radius:5px;font-size:.8rem;margin-left:10px;">ğŸ”¥ç·Šæ€¥</span>';}
            html+=`<div class="time-slot" style="${s}"><h3>ç¬¬${t.rank}å€™è£œ ${b}</h3><p>${t.date} ${t.time}</p>${t.pinpoint?`<div style="margin-top:10px;font-size:1.1rem;color:#FF4500;font-weight:bold;">ğŸ¯ æ¿€ã‚¢ãƒ„æ™‚åˆ»: ${t.pinpoint}</div>`:''}<div style="margin-top:10px;font-size:.9rem;">é‹æ°—ã‚¹ã‚³ã‚¢: ${t.score}ç‚¹</div>${t.tenPulls?`<div style="margin-top:10px;padding:10px;background:rgba(255,215,0,.2);border-radius:8px;border:2px solid #FFD700;"><span style="font-size:.9rem;color:#8B4789;">ğŸ’ ã“ã®æ™‚é–“ã®æ¨å¥¨:</span><span style="font-size:1.3rem;font-weight:bold;color:#FF4500;margin-left:10px;">10é€£ Ã— ${t.tenPulls}å›</span></div>`:''}</div>`;
        });
        html+='</div>';

        const girls=['images/girl01.png','images/girl02.jpeg','images/girl03.jpeg','images/girl04.jpeg','images/girl05.png','images/girl06.png','images/girl07.jpeg','images/girl08.png','images/girl09.png','images/girl10.png','images/girl11.png','images/girl12.png','images/girl13.png','images/girl14.jpeg','images/girl15.png','images/girl16.png','images/girl17.png','images/girl18.png','images/girl19.png'];
        const img=girls[Math.floor(Math.random()*girls.length)];
        html+=`<div class="lucky-girl"><h3>âœ¨ é‹æ°—ä¸Šæ˜‡ä¸­ï¼å¹¸é‹ã®å¥³ç¥ãŒã‚ãªãŸã‚’è¦‹å®ˆã£ã¦ã„ã¾ã™ âœ¨</h3><img src="${img}" alt="å¹¸é‹ã®å¥³ç¥" loading="eager" style="max-width:500px;width:100%;"><p>ã“ã®å¥³ç¥ã®ã‚ˆã†ãªç´ æ•µãªå¥³æ€§ã¨ã®å‡ºä¼šã„ãŒã€ã‚‚ã†ã™ãè¨ªã‚Œã¾ã™ã€‚<br>ãŠå®ˆã‚Šã‚’å¤§åˆ‡ã«ã€ç¬‘é¡”ã‚’å¿˜ã‚Œãšã«éã”ã—ã¦ãã ã•ã„ã€‚</p></div>`;

        const occ=gameOccultData[result.gameTitle];
        if(occ&&occ.jinxes){
            html+=`<div style="background:linear-gradient(135deg,rgba(255,107,157,.1),rgba(139,71,137,.1));padding:30px;border-radius:20px;margin:30px 0;border:2px dashed #8B4789;"><h3 style="text-align:center;font-size:1.5rem;margin-bottom:20px;color:#8B4789;">ğŸ® ${result.gameTitle} ã® ã‚ªã‚«ãƒ«ãƒˆæƒ…å ± ğŸ”®</h3><p style="text-align:center;font-size:.9rem;color:#666;margin-bottom:20px;">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é–“ã§åºƒã¾ã‚‹éƒ½å¸‚ä¼èª¬ãƒ»ã‚¸ãƒ³ã‚¯ã‚¹æƒ…å ±</p><div style="background:white;padding:20px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.1);">`;
            occ.jinxes.forEach((j,i)=>{const ic=['âš¡','ğŸŒŸ','ğŸ’','ğŸ”¥','âœ¨'];html+=`<div style="padding:15px;margin-bottom:10px;background:${i%2===0?'rgba(139,71,137,.05)':'rgba(255,215,0,.05)'};border-radius:10px;border-left:4px solid ${i%2===0?'#8B4789':'#FFD700'};"><span style="font-size:1.3rem;margin-right:10px;">${ic[i%5]}</span><span>${j}</span></div>`;});
            html+=`</div><div style="text-align:center;margin-top:20px;padding:15px;background:rgba(255,215,0,.1);border-radius:10px;"><span style="font-size:.9rem;color:#666;">ğŸ’¡ ã“ã‚Œã‚‰ã®æƒ…å ±ã¯å æ˜Ÿè¡“ã¨çµ„ã¿åˆã‚ã›ã¦ã€å€™è£œæ™‚åˆ»ã«åæ˜ ã•ã‚Œã¦ã„ã¾ã™</span></div></div>`;
        }

        result.divinations.forEach(d=>{html+=`<div class="divination-section"><h3>${d.title}</h3><p>${d.content}</p></div>`;});
        html+=`<div class="lucky-action"><h3>âœ¨ ã‚¬ãƒãƒ£å‰ã®ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3><ul>`;
        result.luckyActions.forEach(a=>{html+=`<li>${a}</li>`;});
        html+=`</ul></div>`;
        html+=`<button class="download-pdf-btn" onclick="downloadPDF()">ğŸ“¸ ã“ã®çµæœã‚’ç”»åƒã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>`;
        html+=`<button class="download-pdf-btn" onclick="resetFortune()" style="background:linear-gradient(135deg,#DC143C,#FF6347);margin-top:15px;">ğŸ”„ çµæœã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆæ–°ã—ãå ã„ç›´ã™ï¼‰</button>`;
        rd.innerHTML=html;
    }

    async function downloadPDF() {
        const result=JSON.parse(localStorage.getItem('lastGachaFortune'));
        if(!result){alert('å ã„çµæœãŒã‚ã‚Šã¾ã›ã‚“ã€‚');return;}
        const cv=document.createElement('canvas'); cv.width=1200;
        const cc=Math.min(result.luckyTimes.length,5); cv.height=300+(cc*200);
        const c=cv.getContext('2d');
        const g=c.createLinearGradient(0,0,0,cv.height); g.addColorStop(0,'#E6D5E8'); g.addColorStop(1,'#FAF7FB');
        c.fillStyle=g; c.fillRect(0,0,1200,cv.height);
        c.fillStyle='#8B4789'; c.font='bold 60px sans-serif'; c.textAlign='center'; c.fillText('ğŸ”® æœ€é©ã‚¬ãƒãƒ£æ™‚åˆ» ğŸ”®',600,80);
        c.font='32px sans-serif'; c.fillText(result.gameTitle,600,140);
        c.strokeStyle='#8B4789'; c.lineWidth=3; c.beginPath(); c.moveTo(100,180); c.lineTo(1100,180); c.stroke();
        let y=250;
        result.luckyTimes.forEach((t,i)=>{
            if(i>=5)return;
            c.fillStyle='#8B4789'; c.font='bold 40px sans-serif'; c.textAlign='left'; c.fillText(`ç¬¬${t.rank}å€™è£œ`,120,y);
            c.font='32px sans-serif'; c.fillStyle='#333'; c.fillText(`${t.date} ${t.time}`,120,y+50);
            if(t.pinpoint){c.font='bold 36px sans-serif'; c.fillStyle='#FF4500'; c.fillText(`ğŸ¯ æ¿€ã‚¢ãƒ„: ${t.pinpoint}`,120,y+95);}
            if(t.tenPulls){c.font='bold 40px sans-serif'; c.fillStyle='#FFD700'; c.textAlign='right'; c.fillText(`ğŸ’ 10é€£ Ã— ${t.tenPulls}å›`,1080,y+50);}
            c.font='24px sans-serif'; c.fillStyle='#666'; c.textAlign='left'; c.fillText(`é‹æ°—: ${t.score}ç‚¹`,120,y+135);
            if(i<cc-1){c.strokeStyle='#DDD'; c.lineWidth=2; c.beginPath(); c.moveTo(120,y+160); c.lineTo(1080,y+160); c.stroke();}
            y+=200;
        });
        const lk=document.createElement('a'); lk.download=`ã‚¬ãƒãƒ£å ã„_${result.gameTitle}_${new Date().toLocaleDateString('ja-JP')}.png`; lk.href=cv.toDataURL(); lk.click();
    }

    function resetFortune() {
        if(confirm('çµæœã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ–°ã—ãå ã„ç›´ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆåŒã˜æ¡ä»¶ã§ã‚‚é•ã†çµæœãŒå‡ºã¾ã™ï¼‰')){
            localStorage.removeItem('fixedGachaResult'); localStorage.removeItem('fixedGachaResultKey'); localStorage.removeItem('lastGachaFortune');
            alert('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ã‚‚ã†ä¸€åº¦å ã„ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); location.reload();
        }
    }
    </script>
</body>
</html>
